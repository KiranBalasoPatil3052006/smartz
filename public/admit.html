<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Content-Security-Policy"
        content="connect-src 'self' https://smart-cart-app-h47v.onrender.com http://localhost:5000;">
    <title>Smart Cart - Admin Dashboard</title>
    <link rel="stylesheet" href="AdmitStyle.css" />
    <link rel="icon" type="image/x-icon" href="images/favicon.ico" />
    <style>
        /* === Manage Products Section === */
        #product-manage-section {
            display: none;
            background: #fff8f2;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        #product-manage-section input {
            width: 90%;
            max-width: 400px;
            padding: 10px;
            margin: 10px auto;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 1rem;
        }

        #product-manage-section button {
            background: #350410;
            color: white;
            padding: 10px 18px;
            margin: 8px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
        }

        #product-manage-section button:hover {
            background: #5c0a1c;
        }

        #product-message {
            display: none;
            margin-top: 10px;
            padding: 8px;
            border-radius: 6px;
            font-weight: bold;
        }

        #product-message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }

        #product-message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }

        /* === Product Table === */
        #product-table {
            margin-top: 20px;
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        #product-table th,
        #product-table td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: center;
            font-size: 1rem;
            color: #350410;
        }

        #product-table th {
            background: #350410de;
            color: white;
        }

        @media (max-width: 768px) {

            #product-table,
            #product-table thead,
            #product-table tbody,
            #product-table th,
            #product-table td,
            #product-table tr {
                display: block;
            }

            #product-table thead {
                display: none;
            }

            #product-table tr {
                margin-bottom: 15px;
                border: 1px solid #ccc;
                border-radius: 8px;
                background-color: #fff;
                box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
                padding: 10px;
            }

            #product-table td {
                padding: 10px 10px 10px 50%;
                text-align: left;
                position: relative;
            }

            #product-table td::before {
                content: attr(data-label);
                position: absolute;
                left: 15px;
                top: 10px;
                font-weight: bold;
                color: #333;
            }
        }
    </style>
</head>

<body>
    <div class="sidebar" id="sidebar">
        <a href="#" onclick="showMainPage()">Home</a>
        <a href="#" onclick="showCustomers()">Customers</a>
        <a href="#" onclick="showCashPayments()">Cash Payments</a>
        <a href="#" onclick="showOnlinePayments()">Online Payments</a>
        <a href="#" onclick="showCashierCodes()">Cashier Codes</a>
        <a href="#" onclick="showProductManager()">Manage Products</a>
        <a href="adminlogin.html">Logout</a>
    </div>

    <div class="menu-toggle" onclick="toggleSidebar()"><span></span><span></span><span></span></div>

    <div class="main-content" id="mainContent">
        <div class="container">
            <h1 class="admin-heading">Smart Cart - Admin</h1>
            <button id="back-btn" class="btn" style="display:none;" onclick="backToHome()">Back</button>
            <div id="messageBox"></div>

            <!-- Manage Products -->
            <div id="product-manage-section">
                <h2>Manage Products</h2>
                <input type="text" id="barcode" placeholder="Enter Barcode" />
                <button onclick="fetchProduct()">Search</button><br>
                <input type="text" id="product-name" placeholder="Product Name" />
                <input type="number" id="price" placeholder="Price (₹)" /><br>
                <button onclick="addProduct()">Add</button>
                <button onclick="updateProduct()">Update</button>
                <button onclick="deleteProduct()">Delete</button>
                <button onclick="backToHome()">Back</button>
                <div id="product-message"></div>

                <!-- Product Table -->
                <h2>All Products</h2>
                <table id="product-table">
                    <thead>
                        <tr>
                            <th>Barcode</th>
                            <th>Name</th>
                            <th>Price</th>
                        </tr>
                    </thead>
                    <tbody id="product-body"></tbody>
                </table>
            </div>

            <!-- Summary section -->
            <div id="summary-history-section">
                <h2>Customer Purchase Summary</h2>
                <table id="summary-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Mobile</th>
                            <th>Date</th>
                            <th>Time</th>
                            <th>Amount</th>
                            <th>Payment</th>
                        </tr>
                    </thead>
                    <tbody id="summary-body"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const BASE_URL = "https://smart-cart-app-h47v.onrender.com";
        const msgBox = document.getElementById("product-message");

        function showMsg(msg, type) {
            msgBox.textContent = msg;
            msgBox.className = type;
            msgBox.style.display = "block";
        }

        function toggleSidebar() {
            document.getElementById("sidebar").classList.toggle("active");
            document.querySelector(".menu-toggle").classList.toggle("open");
        }

        function resetSections() {
            ["summary-history-section", "customer-section", "cashier-code-display", "product-manage-section"]
                .forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.style.display = "none";
                });
            document.getElementById("back-btn").style.display = "inline-block";
        }

        function showProductManager() {
            resetSections();
            document.getElementById("product-manage-section").style.display = "block";
            loadProducts();
        }

        async function loadProducts() {
            const body = document.getElementById("product-body");
            body.innerHTML = "<tr><td colspan='3'>Loading...</td></tr>";
            try {
                const res = await fetch(`${BASE_URL}/all-products`);
                const data = await res.json();
                if (data.success) {
                    body.innerHTML = "";
                    data.products.forEach(p => {
                        const row = `<tr>
              <td data-label='Barcode'>${p.barcode}</td>
              <td data-label='Name'>${p.name}</td>
              <td data-label='Price'>₹${p.price}</td>
            </tr>`;
                        body.innerHTML += row;
                    });
                } else {
                    body.innerHTML = "<tr><td colspan='3'>No products found</td></tr>";
                }
            } catch {
                body.innerHTML = "<tr><td colspan='3'>Error loading products</td></tr>";
            }
        }

        async function fetchProduct() {
            const barcode = document.getElementById("barcode").value.trim();
            if (!barcode) return showMsg("Enter barcode to search", "error");
            try {
                const res = await fetch(`${BASE_URL}/product-manage/${barcode}`);
                const data = await res.json();
                if (data.success) {
                    document.getElementById("product-name").value = data.product.name;
                    document.getElementById("price").value = data.product.price;
                    showMsg("Product found and loaded", "success");
                } else showMsg("Product not found", "error");
            } catch {
                showMsg("Server error", "error");
            }
        }

        async function addProduct() {
            const barcode = document.getElementById("barcode").value.trim();
            const name = document.getElementById("product-name").value.trim();
            const price = document.getElementById("price").value.trim();
            if (!barcode || !name || !price) return showMsg("All fields required", "error");
            try {
                const res = await fetch(`${BASE_URL}/add-product`, {
                    method: "POST", headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ barcode, name, price })
                });
                const data = await res.json();
                showMsg(data.message, data.success ? "success" : "error");
                if (data.success) loadProducts();
            } catch {
                showMsg("Server error", "error");
            }
        }

        async function updateProduct() {
            const barcode = document.getElementById("barcode").value.trim();
            const name = document.getElementById("product-name").value.trim();
            const price = document.getElementById("price").value.trim();
            if (!barcode || !name || !price) return showMsg("All fields required", "error");
            try {
                const res = await fetch(`${BASE_URL}/update-product/${barcode}`, {
                    method: "PUT", headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ name, price })
                });
                const data = await res.json();
                showMsg(data.message, data.success ? "success" : "error");
                if (data.success) loadProducts();
            } catch {
                showMsg("Server error", "error");
            }
        }

        async function deleteProduct() {
            const barcode = document.getElementById("barcode").value.trim();
            if (!barcode) return showMsg("Enter barcode to delete", "error");
            if (!confirm("Delete this product?")) return;
            try {
                const res = await fetch(`${BASE_URL}/delete-product/${barcode}`, { method: "DELETE" });
                const data = await res.json();
                showMsg(data.message, data.success ? "success" : "error");
                if (data.success) loadProducts();
            } catch {
                showMsg("Server error", "error");
            }
        }

        function backToHome() {
            document.getElementById("product-manage-section").style.display = "none";
            document.getElementById("summary-history-section").style.display = "block";
            document.getElementById("back-btn").style.display = "none";
        }
    </script>
</body>

</html>
